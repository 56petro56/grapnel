
/****
 * Grapnel.js
 * https://github.com/gregsabia/Grapnel.js 
 * 
 * @author Greg Sabia
 * @link http://gregsabia.com
 * @version 0.3.1
 * 
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
*/

(function(e){function t(e){"use strict";var n=this;this._actions=[];this._listeners=[];this.action=null;this.hook=e||":";this.value=null;this.params=[];this.anchor={defaultHash:window.location.hash};this.version="0.3.1";this.add=function(e,t){var r=function(){var r=n.action&&e instanceof RegExp?n.anchor.get().match(e):false;if(r||e===n.action||n.anchor.get()==e){n._trigger("match",n.value,n.params,n.action,r);n._actions.push({name:e,handler:t});t.call(n,n.value,n.params,r)}return n};return r().on(["initialized","hashchange"],r)};this._trigger=function(e){var t=Array.prototype.slice.call(arguments,1);n._forEach(n._listeners,function(r){if(r.event==e)r.handler.apply(n,t)});return n};this.on=function(e,t){var r=typeof e==="string"?e.split():e;this._forEach(r,function(e){n._listeners.push({event:e,handler:t})});return this};this._map=function(e,t){if(typeof Array.prototype.map==="function")return Array.prototype.map.call(e,t);return function(e,t){var n=new Array(this.length);for(var r=0,i=this.length;r<i;r++){if(r in this)n[r]=e.call(t,this[r],r,this)}return n}.call(e,t)};this._forEach=function(e,t){if(typeof Array.prototype.forEach==="function")return Array.prototype.forEach.call(e,t);return function(e,t){for(var n=0,r=this.length;n<r;++n){e.call(t,this[n],n,this)}}.call(e,t)};this._routeRegExp=function(e,t,n,r){if(e instanceof RegExp)return e;if(e instanceof Array)e="("+e.join("|")+")";e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,r,i,s,o){t.push({name:i,optional:!!o});n=n||"";return""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+e+"$",n?"":"i")};this.anchor.get=function(){return window.location.hash?window.location.hash.split("#")[1]:""};this.anchor.set=function(e){window.location.hash=!e?"":e;return n};this.anchor.clear=function(){return this.set(false)};this.parse=function(){var e=this.anchor.get(),t=e.split(this.hook),n=e.match(this.hook),r=t[0],i=[],s;if(this.anchor.get().match(this.hook)){i=t.slice(1);s=i.join(n[0])}this._trigger("parse",t);return{value:s,action:r,params:i}};this.matches=function(){var e=[];this._forEach(this._actions,function(t){var r=t.name instanceof RegExp&&n.action.match(t.name);if(r||t.name===n.action){e.push(t)}});return e};this.router=function(){return t.Router()};this.on(["initialized","hashchange"],function(){var e=this.parse();this.action=e.action;this.value=e.value;this.params=e.params;this._actions=[]});if(typeof window.onhashchange==="function")this.on("hashchange",window.onhashchange);window.onhashchange=function(){n._trigger("hashchange")};return this._trigger("initialized")}t.Router=function(){var e=new t(/\//gi);e.get=function(t,n){var r=[];var i=new this._routeRegExp(t,r);e.add(i,function(t,i,s){var o={params:{},keys:r,matches:s.slice(1)};e._forEach(o.matches,function(e,t){var n=r[t]&&r[t].name?r[t].name:t;o.params[n]=e?decodeURIComponent(e):undefined});n.call(e,o)});return e};return e._trigger("initialized")};if("function"===typeof e.define){e.define(function(e){return t})}else if("object"===typeof exports){exports.Grapnel=t}else{e.Grapnel=t}}).call({},window)